<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">

        function getUUID() {
            function s4() {
                return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);
            }
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
        }

        function pageLog(log_data) {

            document.getElementById("logArea").innerHTML = document.getElementById("logArea").innerHTML + log_data + "<br>";
        }

        $(document).on('mouseup', '#loginButton', function () {

            var login_url = "https://nid.naver.com/oauth2.0/authorize";

            var response_type = "code";
            var client_id = "rtgvfRcGt3nfOTH1mVuZ";
            var redirect_uri = encodeURI("https://ap0000114.github.io/web3/index.html", "UTF-8");
            var state = getUUID();

            login_url = login_url +
                "?response_type=" + response_type +
                "&client_id=" + client_id +
                "&redirect_uri=" + redirect_uri +
                "&state=" + state;

            window.prompt("msg", login_url);
            window.open(login_url, "width=400, height=300, left=100, top=50"); 
            //window.location.href = login_url;

        });

        $(document).on('mouseup', '#loginAuthButton', function () {

            pageLog("콜백 데이터  : [" + location.href + "]");

            var tempString = location.search;

            var find_code = "code=";
            var find_state = "state=";
            var find_error = "error=";
            var find_error_description = "error_description=";

            var code = "";
            var state = "";
            var error = "";
            var error_description = "";

            if (tempString.indexOf(find_code) != -1) {
                code = tempString.substring(tempString.indexOf(find_code) + find_code.length);

                if (code.indexOf("&") != -1) {
                    code = code.substring(0, code.indexOf("&"));
                }
            } else {
                pageLog(find_code + " is not found");
            }

            if (tempString.indexOf(find_state) != -1) {
                state = tempString.substring(tempString.indexOf(find_state) + find_state.length);

                if (state.indexOf("&") != -1) {
                    state = state.substring(0, state.indexOf("&"));
                }
            } else {
                pageLog(find_state + " is not found");
            }

            if (tempString.indexOf(find_error) != -1) {
                error = tempString.substring(tempString.indexOf(find_error) + find_error.length);

                if (error.indexOf("&") != -1) {
                    error = error.substring(0, error.indexOf("&"));
                }
            } else {
                pageLog(find_error + " is not found");
            }

            if (tempString.indexOf(find_error_description) != -1) {
                error_description = tempString.substring(tempString.indexOf(find_error_description) + find_error_description.length);

                if (error_description.indexOf("&") != -1) {
                    error_description = error_description.substring(0, error_description.indexOf("&"));
                }
            } else {
                pageLog(find_error_description + " is not found");
            }

            pageLog("code : [" + code + "]");
            pageLog("state : [" + state + "]");
            pageLog("error : [" + error + "]");
            pageLog("error_description : [" + error_description + "]");


            var login_url = "https://nid.naver.com/oauth2.0/token";

            var grant_type = "authorization_code";
            var client_id = "rtgvfRcGt3nfOTH1mVuZ";
            var client_secret = "tjfTeXkquy";
            var code = code;
            var state = state;

            var refresh_token = "";
            var access_token = "";
            var service_provider = "";

            login_url = login_url +
                "?grant_type=" + grant_type +
                "&client_id=" + client_id +
                "&client_secret=" + client_secret +
                "&code=" + code +
                "&state=" + state;

            pageLog(login_url);
            window.prompt("msg", login_url);
            

        });

        $(document).on('mouseup', '#testButton', function () {
            //var tempString = "?code=QDQoKuGx6EdsHU7OSM&state=e77eefd0-0b2f-d754-bb5f-4890e6e71a38";
            var tempString = "?state=e77eefd0-0b2f-d754-bb5f-4890e6e71a38%error=QDQoKuGx6EdsHU7OSM&error_description=123ff123d123";


        });



    </script>
</head>

<body>

    <input type="button" id="loginButton" value="loginButton" />
    <input type="button" id="loginAuthButton" value="loginAuthButton" />
    <input type="button" id="testButton" value="testButton" />
    <div id="logArea"></div>

</body>

</html>
